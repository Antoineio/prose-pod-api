{
	"paths": {
		"check_ports": {
			"tags": ["Network configuration checker"],
			"summary": "Check ports reachability",
			"description": "Checks that all required ports are opened and reachable.\n\nThis route regularly checks the domain's open ports to provide \"live\" information. It opens a stream of Server-Sent Events and sends `port-reachability-check-result` events every few seconds.\nNOTE: There might be a `(\\n|^):(\\n|$)` lurking in one of the events. We don't know where it comes from and it should be ignored by SSE parsers but don't be suprised to see it.",
			"operationId": "check_ports",
			"security": [{ "BearerAuth": [] }],
			"parameters": [{ "$ref": "../shared.json#/components/parameters/RetryInterval" }],
			"responses": {
				"200": {
					"description": "Success",
					"content": {
						"application/json": {
							"schema": {
								"type": "array",
								"items": {
									"$ref": "#/components/schemas/sse-events/port-reachability-check-result"
								}
							},
							"example": [
								{
									"id": "TCP-c2s",
									"event": "port-reachability-check-result",
									"data": {
										"description": "Client-to-server port at TCP 5222",
										"status": "OPEN"
									}
								},
								{
									"id": "TCP-s2s",
									"event": "port-reachability-check-result",
									"data": {
										"description": "Server-to-server port at TCP 5269",
										"status": "CLOSED"
									}
								},
								{
									"id": "TCP-HTTPS",
									"event": "port-reachability-check-result",
									"data": {
										"description": "HTTP server port at TCP 443",
										"status": "OPEN"
									}
								}
							]
						},
						"text/event-stream": {
							"schema": {
								"type": "array",
								"items": {
									"oneOf": [
										{ "$ref": "#/components/schemas/sse-events/port-reachability-check-result" },
										{ "$ref": "../shared.json#/components/schemas/sse-events/end" }
									],
									"discriminator": {
										"propertyName": "event"
									}
								}
							},
							"example": "id:TCP-c2s\n:\nevent:port-reachability-check-result\ndata:{\"description\":\"Client-to-server port at TCP 5222\",\"status\":\"QUEUED\"}\n\nid:TCP-s2s\nevent:port-reachability-check-result\ndata:{\"description\":\"Server-to-server port at TCP 5269\",\"status\":\"QUEUED\"}\n\nid:TCP-HTTPS\nevent:port-reachability-check-result\ndata:{\"description\":\"HTTP server port at TCP 443\",\"status\":\"QUEUED\"}\n\nid:TCP-c2s\n:\nevent:port-reachability-check-result\ndata:{\"description\":\"Client-to-server port at TCP 5222\",\"status\":\"CHECKING\"}\n\nid:TCP-s2s\nevent:port-reachability-check-result\ndata:{\"description\":\"Server-to-server port at TCP 5269\",\"status\":\"CHECKING\"}\n\nid:TCP-HTTPS\nevent:port-reachability-check-result\ndata:{\"description\":\"HTTP server port at TCP 443\",\"status\":\"CHECKING\"}\n\nid:TCP-c2s\nevent:port-reachability-check-result\ndata:{\"description\":\"Client-to-server port at TCP 5222\",\"status\":\"OPEN\"}\n\nid:TCP-s2s\nevent:port-reachability-check-result\ndata:{\"description\":\"Server-to-server port at TCP 5269\",\"status\":\"CLOSED\"}\n\nid:TCP-HTTPS\nevent:port-reachability-check-result\ndata:{\"description\":\"HTTP server port at TCP 443\",\"status\":\"OPEN\"}\n\nid:TCP-s2s\nevent:port-reachability-check-result\ndata:{\"description\":\"Server-to-server port at TCP 5269\",\"status\":\"OPEN\"}\n\n:End of stream\nid:end\nevent:end\ndata:\n\n\n"
						}
					}
				},
				"401": { "$ref": "../shared.json#/components/responses/Unauthorized" },
				"403": { "$ref": "../shared.json#/components/responses/Forbidden" }
			}
		}
	},
	"components": {
		"schemas": {
			"PortReachabilityStatus": {
				"type": "string",
				"enum": ["QUEUED", "CHECKING", "OPEN", "CLOSED"]
			},
			"PortReachabilityCheckResult": {
				"type": "object",
				"required": ["description", "status"],
				"properties": {
					"description": { "type": "string" },
					"status": { "$ref": "#/components/schemas/PortReachabilityStatus" }
				},
				"example": {
					"description": "Client-to-server port at TCP 5222",
					"status": "OPEN"
				}
			},
			"sse-events": {
				"port-reachability-check-result": {
					"summary": "A Server-Sent Event containing the result of a port reachability check.",
					"type": "object",
					"required": ["event", "id", "data"],
					"properties": {
						"event": {
							"type": "string",
							"example": "port-reachability-check-result"
						},
						"id": { "$ref": "#/components/schemas/sse-event-ids/PortReachabilityCheckId" },
						"data": { "$ref": "#/components/schemas/PortReachabilityCheckResult" }
					}
				}
			},
			"sse-event-ids": {
				"PortReachabilityCheckId": {
					"type": "string",
					"enum": ["TCP-c2s", "TCP-s2s", "TCP-HTTPS"]
				}
			}
		}
	}
}
